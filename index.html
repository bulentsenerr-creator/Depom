<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <meta name="theme-color" content="#2c3e50" />
  <title>GeliÅŸmiÅŸ KitaplÄ±ÄŸÄ±m</title>
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="stylesheet" href="style.css" />
  <!-- Excel desteÄŸi (XLSX) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <!-- Barkod (QuaggaJS) -->
  <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>ðŸ“š KiÅŸisel KitaplÄ±ÄŸÄ±m</h1>

    <div class="form-section">
      <div class="search-bar">
        <input type="text" id="isbnSearch" placeholder="ISBN No ile Ara (Ã–rn: 9789750719387)" />
        <button type="button" onclick="searchBook()">Google + OpenLibrary ile Getir</button>
        <button type="button" id="barcodeBtn">Barkod ile Getir</button>
        <!-- Kamera seÃ§imi (opsiyonel) -->
        <select id="cameraSelect" title="Kamera SeÃ§ (opsiyonel)">
          <option value="">Otomatik (varsayÄ±lan)</option>
        </select>
      </div>

      <div class="cover-preview" id="coverPreviewWrap" style="display:none">
        <img id="coverPreview" alt="Kapak Ã–nizleme" />
        <div class="cover-preview-meta">
          <div id="coverPreviewTitle" class="cover-preview-title"></div>
          <div id="coverPreviewMsg" class="cover-preview-msg"></div>
        </div>
      </div>

      <div id="bookForm" class="manual-form">
        <input type="text" id="title" placeholder="Kitap AdÄ± *" />
        <input type="text" id="author" placeholder="Yazar" />
        <input type="text" id="translator" placeholder="Ã‡eviren" />
        <input type="text" id="isbn" placeholder="ISBN" />
        <input type="text" id="publisher" placeholder="YayÄ±ncÄ±" />
        <input type="text" id="language" placeholder="Dil (Ã–rn: tr, en)" />
        <input type="text" id="edition" placeholder="BaskÄ± (Ã–rn: 3. baskÄ±)" />
        <input type="text" id="publishedDate" placeholder="YayÄ±nlanma Tarihi (YYYY / YYYY-AA / YYYY-AA-GG)" />
        <input type="number" id="pageCount" placeholder="Sayfa SayÄ±sÄ±" min="0" />
        <select id="format">
          <option value="">Format SeÃ§in</option>
          <option value="Ciltli">Ciltli</option>
          <option value="Ciltsiz">Ciltsiz</option>
          <option value="Deri ciltli">Deri ciltli</option>
          <option value="Defter">Defter</option>
          <option value="Kutulu set">Kutulu set</option>
          <option value="Geleneksel olmayan">Geleneksel olmayan</option>
          <option value="CD">CD</option>
          <option value="DVD">DVD</option>
          <option value="Ekitap">Ekitap</option>
          <option value="DiÄŸer">DiÄŸer</option>
        </select>
        <input type="date" id="purchaseDate" placeholder="SatÄ±n Alma Tarihi" />
        <input type="text" id="purchasePlace" placeholder="SatÄ±n AlÄ±nan Yer" />
        <input type="number" id="price" placeholder="Fiyat (TL)" min="0" step="0.01" />
        <input type="text" id="categories" placeholder="Kategoriler (virgÃ¼lle)" />
        <input type="text" id="tags" placeholder="Etiketler (virgÃ¼lle)" />
        <textarea id="description" placeholder="AÃ§Ä±klama" rows="4"></textarea>

        <!-- Kapak: otomatik veya manuel -->
        <input type="hidden" id="coverImg" />
        <input type="text" id="coverUrl" placeholder="Kapak URL (opsiyonel)" />
        <input type="file" id="coverFile" accept="image/*" />
        <button type="button" class="cover-clear-btn" onclick="clearCover()">KapaÄŸÄ± Temizle</button>

        <button type="button" onclick="saveBook()" class="save-btn" id="saveBtn">KÃ¼tÃ¼phaneye Ekle</button>
        <button type="button" onclick="cancelEdit()" class="cancel-btn" id="cancelBtn" style="display:none">VazgeÃ§</button>
      </div>
    </div>

    <hr />

    <!-- Ara / Filtre / Ä°Ã§e-DÄ±ÅŸa Aktar AraÃ§ Ã‡ubuÄŸu -->
    <div class="toolbar">
      <div class="filters-bar">
        <input type="text" id="fQuery" placeholder="AnÄ±nda Ara (ad, yazar, ISBN, yayÄ±nevi, etiket, kategori...)" />
        <select id="fFormat">
          <option value="">Format (tÃ¼mÃ¼)</option>
        </select>
        <select id="fLang">
          <option value="">Dil (tÃ¼mÃ¼)</option>
        </select>
        <input type="number" id="fMinPrice" min="0" step="0.01" placeholder="Min Fiyat" />
        <input type="number" id="fMaxPrice" min="0" step="0.01" placeholder="Maks Fiyat" />
        <button type="button" id="fClearBtn">Filtreyi Temizle</button>

        <!-- Ã‡oklu seÃ§im: Kategoriler & Etiketler -->
        <select id="fCats" class="multiselect" multiple size="4" title="CTRL/CMD ile Ã§oklu seÃ§im yapÄ±n"></select>
        <select id="fTags" class="multiselect" multiple size="4" title="CTRL/CMD ile Ã§oklu seÃ§im yapÄ±n"></select>

        <!-- SÄ±ralama -->
        <select id="sortBy" title="SÄ±ralama Ã¶lÃ§Ã¼tÃ¼">
          <option value="added-desc" selected>Eklenme (Yeniâ†’Eski)</option>
          <option value="added-asc">Eklenme (Eskiâ†’Yeni)</option>
          <option value="title-asc">Ad (Aâ†’Z)</option>
          <option value="title-desc">Ad (Zâ†’A)</option>
          <option value="purchase-asc">SatÄ±n Alma Tarihi (Eskiâ†’Yeni)</option>
          <option value="purchase-desc">SatÄ±n Alma Tarihi (Yeniâ†’Eski)</option>
          <option value="price-asc">Fiyat (Artan)</option>
          <option value="price-desc">Fiyat (Azalan)</option>
          <option value="pages-asc">Sayfa (Artan)</option>
          <option value="pages-desc">Sayfa (Azalan)</option>
        </select>
      </div>

      <div class="io-bar">
        <button type="button" id="exportJsonBtn">DÄ±ÅŸa Aktar (JSON)</button>
        <button type="button" id="importJsonBtn">Ä°Ã§e Aktar (JSON)</button>
        <button type="button" id="exportExcelBtn">Excelâ€™e Aktar (.xlsx)</button>
        <button type="button" id="importExcelBtn">Excelâ€™den Ä°Ã§e Aktar (.xlsx)</button>
        <!-- Gizli dosya girdileri (Ã§oklu seÃ§im aÃ§Ä±k) -->
        <input type="file" id="importJsonFile" accept="application/json" style="display:none" multiple />
        <input type="file" id="importExcelFile" accept=".xlsx,.xls" style="display:none" multiple />
      </div>
    </div>

    <div class="stats">
      <p>
        Filtrelenen: <span id="filteredCount">0</span> /
        Toplam Kitap: <span id="totalBooks">0</span>
        &nbsp;&nbsp;|&nbsp;&nbsp; Toplam Harcama: <span id="totalSpend">0</span> TL
      </p>
    </div>

    <div id="libraryGrid" class="library-grid"></div>
  </div>

  <!-- Lightbox (kapak bÃ¼yÃ¼k Ã¶nizleme) -->
  <div id="lightbox" class="lightbox" style="display:none" role="dialog" aria-modal="true">
    <div class="lightbox-backdrop" onclick="closeLightbox()"></div>
    <div class="lightbox-content">
      <button type="button" class="lightbox-close" onclick="closeLightbox()" aria-label="Kapat">âœ•</button>
      <img id="lightboxImg" alt="Kapak" />
      <div id="lightboxCaption" class="lightbox-caption"></div>
    </div>
  </div>

  <!-- Barkod Modal -->
  <div id="barcodeModal" class="barcode-modal" style="display:none" role="dialog" aria-modal="true">
    <div class="barcode-backdrop" onclick="stopBarcodeScan()"></div>
    <div class="barcode-box">
      <div class="barcode-header">
        <strong>ðŸ“· Barkod Tarama</strong>
        <button type="button" class="barcode-close" onclick="stopBarcodeScan()" aria-label="Kapat">âœ•</button>
      </div>
      <div id="barcodeViewport" class="barcode-viewport"></div>
      <div class="barcode-footer">
        <div class="barcode-actions">
          <button type="button" id="torchBtn" class="torch-btn" disabled>FlaÅŸ: KapalÄ±</button>
        </div>
        <div class="barcode-right">
          <span id="barcodeHint">Kamera izni verin ve barkodu ortalayÄ±n. (ISBN genellikle 978/979 ile baÅŸlar)</span>
          <button type="button" class="barcode-stop" onclick="stopBarcodeScan()">Durdur</button>
        </div>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
